{% extends 'research/base.html' %}
{% load static %}

{% block content %}
<div class="mb-5 animate-appear">
    <h2 class="fw-bold text-dark mb-1">Research Workspace</h2>
    <p class="text-secondary">Analyze documents and detect AI signatures in seconds.</p>
</div>

<div class="row g-4">
    <div class="col-md-4 col-lg-3 animate-stagger" style="--stagger-idx: 1;">
        <a href="{% url 'core:upload' %}" class="text-decoration-none">
            <div class="card h-100 border-dashed d-flex align-items-center justify-content-center p-4 bg-light upload-card-hover"
                style="border: 2px dashed var(--border-color); min-height: 250px;">
                <div class="text-center">
                    <div class="bg-white rounded-circle p-3 shadow-sm mb-3 d-inline-block icon-pulse">
                        <i class="bi bi-plus-lg fs-3 text-primary"></i>
                    </div>
                    <h6 class="fw-bold text-dark">Upload New Paper</h6>
                </div>
            </div>
        </a>
    </div>

    {% for research in researches %}
    <div class="col-md-4 col-lg-3 animate-stagger" style="--stagger-idx: {{ forloop.counter|add:1 }};">
        <div class="card h-100 hover-lift">
            <div class="p-3 bg-light border-bottom d-flex justify-content-center align-items-center card-thumb">
                <i class="bi bi-file-earmark-text fs-1 text-primary opacity-50"></i>
            </div>
            <div class="card-body">
                <h6 class="text-truncate fw-bold mb-1" title="{{ research.title }}">{{ research.title }}</h6>
                <p class="text-muted x-small mb-3">{{ research.date|date:"M d, Y" }}</p>

                <div class="mb-3">
                    {% if research.ai_probability > 0.7 %}
                    <span class="badge bg-danger-subtle text-danger px-2 py-1">AI Generated</span>
                    {% else %}
                    <span class="badge bg-success-subtle text-success px-2 py-1">Human Authored</span>
                    {% endif %}
                </div>

                <a href="{% url 'core:summarize' research.id %}" class="btn btn-primary w-100 btn-sm shadow-sm mb-2">
                    Analyze Summary
                </a>

                <a href="{% url 'core:delete' research.id %}" class="btn btn-outline-danger w-100 btn-sm border-0">
                    <i class="bi bi-trash3 me-1"></i> Delete
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<style>
    /* --- Layout Polish --- */
    .x-small {
        font-size: 0.75rem;
    }

    .bg-danger-subtle {
        background-color: rgba(220, 38, 38, 0.1) !important;
        color: #ef4444 !important;
    }

    .bg-success-subtle {
        background-color: rgba(22, 163, 74, 0.1) !important;
        color: #22c55e !important;
    }

    .card-thumb {
        height: 120px;
        transition: background 0.3s ease;
        background-color: var(--primary-soft) !important;
        border-bottom: 1px solid var(--border-color) !important;
    }

    /* --- Interaction Animations --- */
    .hover-lift {
        transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
        border: 1px solid var(--border-color);
    }

    .hover-lift:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        border-color: var(--primary);
    }

    .upload-card-hover {
        transition: all 0.3s ease;
        background-color: var(--bg-body) !important;
        border-color: var(--border-color) !important;
    }

    .upload-card-hover:hover {
        background-color: var(--bg-card) !important;
        border-color: var(--primary) !important;
        transform: scale(1.02);
    }

    .icon-pulse {
        background-color: var(--bg-card) !important;
    }

    .icon-pulse i {
        display: inline-block;
        transition: transform 0.3s ease;
    }

    .upload-card-hover:hover .icon-pulse i {
        transform: rotate(90deg) scale(1.2);
    }

    /* --- Entrance Animations --- */
    .animate-appear {
        animation: fadeInDown 0.8s ease-out both;
    }

    .animate-stagger {
        opacity: 0;
        animation: slideUpScale 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        /* Using the CSS variable set in the HTML for delay */
        animation-delay: calc(var(--stagger-idx) * 0.1s);
    }

    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideUpScale {
        from {
            opacity: 0;
            transform: translateY(30px) scale(0.95);
        }

        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
</style>
{% endblock %}